<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, interactive-widget=resizes-content" />
  <title>KC-135 Time Calc</title>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JT5DLMYC13"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JT5DLMYC13');
</script>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#0f172a">
  <link rel="apple-touch-icon" sizes="180x180" href="icons/apple-touch-icon-180.png">
  <link rel="apple-touch-icon" sizes="167x167" href="icons/apple-touch-icon-167.png">
  <link rel="apple-touch-icon" sizes="152x152" href="icons/apple-touch-icon-152.png">
  <link rel="apple-touch-icon" sizes="120x120" href="icons/apple-touch-icon-120.png">
  <link rel="icon" type="image/png" sizes="192x192" href="icons/android-chrome-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="icons/android-chrome-512.png">
  <style>
    :root { --bg:#0b1220; --card:#0f172a; --text:#e5e7eb; --muted:#9ca3af; --accent:#22c55e; --stroke:#1f2937; }
    * { box-sizing: border-box; }
    html,body { margin:0; padding:0; background:var(--bg); color:var(--text); font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu; }
    header { padding:4px 12px; background:#0f172a; position:sticky; top:0; z-index:2; border-bottom:1px solid #111827; }
    .head { max-width:520px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:10px; }
    h1 { font-size:1rem; margin:0; letter-spacing:0.3px; }
    .badge { display:flex; align-items:center; gap:8px; background:#0b1220; border:1px solid #1f2937; padding:6px 10px; border-radius:999px; }
    .badge img { width:28px; height:28px; border-radius:50%; object-fit:cover; }
    .badge .txt { font-size:0.75rem; color:#cbd5e1; white-space:nowrap; }
    .dot { opacity:0.5; padding:0 4px; }
    main { max-width:520px; margin:0 auto; padding:10px 8px 80px; }
    .card { background:var(--card); border:1px solid var(--stroke); border-radius:14px; padding:10px; }
    label { display:block; color:#cbd5e1; font-size:0.8rem; margin-bottom:4px; }
    input, select, button { width:100%; padding:10px; border-radius:12px; border:1px solid var(--stroke); background:#0b1220; color:#e5e7eb; font-size:0.95rem; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap:8px; }
    .row-3 { display:grid; grid-template-columns: 1fr 1fr 1fr; gap:8px; }
    .btnbar { display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-top:8px; }
    button.toggle.active { outline:2px solid var(--accent); }
    .section-title { font-weight:400; font-size:0.8rem; margin:10px 0 6px; }
    .timeline { margin-top:8px; background:#0b1220; border:1px solid var(--stroke); border-radius:12px; padding:8px; }
    .line { display:flex; justify-content:space-between; align-items:center; padding:6px 6px; border-bottom:1px dashed #1f2937; }
    .line:last-child { border-bottom:none; }
    .name { font-size:0.9rem; color:#e5e7eb; }
    .time { font-family: ui-monospace,Menlo,Consolas; font-weight:600; letter-spacing:0.5px; }
    .hint { color:#9ca3af; font-size:0.75rem; margin-left:6px; }
    .footer { margin:10px 0; text-align:center; color:#9ca3af; font-size:0.75rem; }
    .sticky-run { position:fixed; left:0; right:0; bottom:0; padding:10px; background:rgba(11,18,32,0.9); backdrop-filter: blur(6px); border-top:1px solid #111827; }
   /* Bottom bar grid - perfectly centered gear */
.sticky-run .row{
  display:grid;
  grid-template-columns: minmax(0,1fr) auto minmax(0,1fr);
  align-items:center;
  justify-items:center;
  gap:12px;
}

/* Side buttons stretch, gear stays snug */
#calc, #reset{
  width:100%;
  justify-self:stretch;
  height:44px;
  border-radius:10px;
}

/* Gear visual */
#defaultsBtn{
  width:auto;
  margin:0;
  padding:6px 10px;
  height:44px;               /* matches calc/reset */
  line-height:1;
  border-radius:6px;
  border:1px solid #334155;
  background:#1e293b;
  color:#e2e8f0;
  font-size:16px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
}
#defaultsBtn span{ transform: translateY(1px); } /* optional emoji micro-align */

    .tiny { font-size:0.75rem; color:#9ca3af; margin-top:2px; }
    ::placeholder { color:#64748b; opacity:1; }
    .nowbox{background:#0b1220;border:1px solid #1f2937;border-radius:10px;padding:10px;font-family:ui-monospace,Menlo,Consolas}

/* Title + centered pill + Copy (flex version) */
.section-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;            /* prevents overlap on small screens */
  margin:10px 0 6px;
}

/* Title (left) */
.section-bar .section-title{
  white-space:nowrap;
  min-width:0;
}

/* Copy button (right) */
.section-bar .copy-btn{
  width:auto !important;
  height:42px;
  padding:10px 18px;
  border-radius:12px;
  background:#15803d;
  color:#0b1220;
  border:none;
  line-height:1;
  cursor:default;
  opacity:.6;
  box-shadow:none;
  transition:background .25s ease, opacity .25s ease, box-shadow .25s ease;
}
.section-bar .copy-btn:not(:disabled){
  background:#22c55e;
  cursor:pointer;
  opacity:1;
}

/* Always 2 columns, even on tiny portrait screens */
#defaultsModal .defaults-grid{
  display:grid !important;
  grid-template-columns: max-content 1fr !important; /* label | select */
  column-gap:10px !important;
  row-gap:8px !important;
  align-items:center !important;
}

/* Tight, non-wrapping labels; tweak size so they fit */
#defaultsModal .defaults-grid > label{
  margin:0;
  font-size:.9rem;
  color:#cbd5e1;
  white-space:nowrap;
}

/* Selects can shrink; keep text visible on Android */
#defaultsModal .defaults-grid > select{
  min-width:0;              /* allow shrinking instead of wrapping */
  width:100%;
  line-height:1.2;
  color:#e5e7eb;
  background:#0b1220;
  -webkit-text-fill-color:#e5e7eb;
  padding:8px 10px;         /* slightly tighter for small phones */
}

/* Option text color on Android list UI */
#defaultsModal option{
  color: #e5e7eb;
  background: #0b1220;
}


/* Force visible text on SELECTS (keep text-fill here) */
#off-show, #off-brief, #off-step, #off-eng,
#tzDep, #tzArr {
  color: #e5e7eb;
  background: #0b1220;
  -webkit-text-fill-color: #e5e7eb;
}

/* Inputs: no text-fill so placeholder can be grey */
#date, #to, #dur {
  color: #e5e7eb;
  background: #0b1220;
}

/* Placeholder tone */
#to::placeholder, #dur::placeholder, #date::placeholder {
  color: #64748b;
  opacity: 1;
}
  
    
#fdpNotice {
  position: relative;              /* normal flow instead of absolute */
  display: inline-flex;
  justify-content: center;
  align-items: center;
  margin: 0 auto;
  pointer-events: none;
  z-index: 0;
}

/* No media query override — same layout for mobile and desktop */

/* FDP Notice pill states */
.notice{
  display: none;
  font-size: 0.82rem;
  font-weight: 500;
  padding: 6px 10px;
  border-radius: 999px;
  white-space: nowrap;
  border: 1px solid transparent;
  transition: all .3s ease;
}
.notice.warn,
.notice.bad{
  display: inline-flex;      /* make it appear when in a state */
  align-items: center;
  gap: 6px;
}
.notice.warn{
  background:#3a2a00; color:#fde68a; border-color:#b45309;
  box-shadow:0 0 12px rgba(234,179,8,.4);
}
.notice.bad{
  background:#3b0f0f; color:#fecaca; border-color:#7f1d1d;
  box-shadow:0 0 14px rgba(239,68,68,.4);
}


/* Calculate button visuals: dim by default, bright when .ready */
#calc{
  transition: background .25s ease, opacity .25s ease;
  opacity:.6;
  background:#15803d;
  color:#0b1220;
  border:none;
  border-radius:10px;
  cursor: default;
}
#calc.ready{
  opacity:1;
  background:#22c55e;
  cursor:pointer;
}
/* Yellow outline when inputs changed since last run */
#calc.ready.needs-run{ position:relative; z-index:0; }
#calc.ready.needs-run::before{
  content:""; position:absolute; inset:0; border-radius:10px;
  box-shadow:0 0 0 2px #facc15 inset; pointer-events:none;
}

button:enabled { cursor: pointer; }

  /* validity states */
input.error {
  border-color: #ef4444 !important;
  box-shadow: 0 0 0 2px rgba(239,68,68,.18) inset;
}
input.ok {
  border-color: #22c55e !important;
}

.bad {
  border: 2px solid #ef4444 !important;
  box-shadow: 0 0 12px 3px rgba(239, 68, 68, 0.5), inset 0 0 6px rgba(239, 68, 68, 0.3);
  transition: box-shadow 0.3s ease, border 0.3s ease;
  animation: redPulse 1.5s ease-in-out 1; /* one-time pulse */
}

@keyframes redPulse {
  0%   { box-shadow: 0 0 0 0 rgba(239,68,68,0.5); }
  50%  { box-shadow: 0 0 20px 8px rgba(239,68,68,0.6); }
  100% { box-shadow: 0 0 12px 3px rgba(239,68,68,0.5); }
}

.warn {
  border: 2px solid #facc15 !important;           /* yellow border */
  box-shadow: 
    0 0 10px 2px rgba(250, 204, 21, 0.5),         /* warm yellow outer glow */
    inset 0 0 4px rgba(250, 204, 21, 0.3);        /* soft inner tint */
  transition: box-shadow 0.3s ease, border 0.3s ease;
}

    /* Force visible selected-value text in collapsed <select> on mobile */
.select-fix{
  color: transparent !important;            /* hide the actual glyph color */
  text-shadow: 0 0 0 #e5e7eb !important;    /* paint the text with shadow color */
  background: #0b1220 !important;
  -webkit-text-fill-color: #e5e7eb !important;
}

    /* 4-column tight layout that still fits on phones */
.row-4.tight-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 6px;
}

/* Offsets grid: make labels/selects match Departure/Arrival TZ */
.row-4.tight-grid select{
  font-size: 0.95rem;                 /* same as global input/select */
  padding: 10px;                      /* same feel as others */
  border-radius: 12px;
  border: 1px solid var(--stroke);
  background: #0b1220;
  color: #e5e7eb;
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
  line-height: 1.2;
}

/* Match the standard <label> style used elsewhere */
.row-4.tight-grid label{
  display: block;
  color: #cbd5e1;
  font-size: 0.8rem;                  /* same as global label */
  margin-bottom: 4px;
  font-weight: 400;                   /* remove the heavier look */
  letter-spacing: 0;                  /* keep it consistent */
  line-height: 1.2;
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Ubuntu;
}

  </style>

</head>


<body>
  <header>
    <div class="head">
      <h1>KC135 Time Calc</h1>
      <div class="badge">
       <a href="https://www.linkedin.com/in/james-m-rumpsa/" target="_blank" title="Visit my LinkedIn" style="display:inline-block;">
    <img src="assets/simba.jpg" alt="SIMBA" onerror="this.style.display='none'" style="cursor:pointer;">
  </a>
        <div class="txt">CAO: 11NOV25 <span class="dot">•</span> SIMBA</div>
      </div>
    </div>
  </header>
  <main>
    <div class="card">
      <div class="row">
        <div>
          <label for="date">Dep Date (Z)</label>
          <input id="date" type="date">
        </div>
        <div>
          <label>Now</label>
          <div id="nowPanel" class="nowbox">--:--L / --:--Z (UTC±?)</div>
        </div>
      </div>

      <div class="row" style="margin-top:6px;">
        <div>
          <label for="tzDep">Departure TZ</label>
          <select id="tzDep"></select>
        </div>
        <div>
          <label for="tzArr">Arrival TZ</label>
          <select id="tzArr"></select>
        </div>
      </div>

      <div class="row" style="margin-top:6px;">
        <div>
          <label for="to">T/O (HH:MM Zulu)</label>
          <input id="to" type="text" inputmode="numeric" placeholder="1430 → 14:30Z">
          <div class="tiny">4 digits only, auto-formats.</div>
        </div>
        <div>
          <label for="dur">Sortie Duration (HH:MM)</label>
          <input id="dur" type="text" inputmode="numeric" placeholder="0500 → 05:00">
        </div>
      </div>

      <div class="section-title">FDP/CDT</div>
      <div class="btnbar">
        <button id="basic" class="toggle">Basic</button>
        <button id="aug" class="toggle">Augmented</button>
      </div>

      <div class="section-title">Mission Profile</div>
      <div class="btnbar">
        <button id="single" class="toggle">Single Ship</button>
        <button id="form" class="toggle">Formation</button>
      </div>

      <div class="section-title">Offsets prior to T/O</div>

<div class="row-4 tight-grid" style="margin-top:6px;">
  <div>
    <label for="off-show">Show</label>
    <select id="off-show"></select>
  </div>
  <div>
    <label for="off-brief">Brief</label>
    <select id="off-brief"></select>
  </div>
  <div>
    <label for="off-step">Step</label>
    <select id="off-step"></select>
  </div>
  <div>
    <label for="off-eng">Eng St</label>
    <select id="off-eng"></select>
  </div>
</div>

        <div></div>
      </div>
    </div>

   <div class="section-bar">
     
  <div class="section-title">Timeline</div>
  <span id="fdpNotice" class="notice" aria-live="polite"></span>
  <button id="copy" class="copy-btn" disabled>Copy</button>
</div>

    <div id="timeline" class="timeline"></div>

    <div class="footer">Works offline. Add to Home screen to install.</div>
  </main>

  <div class="sticky-run">
    <div class="row">
      <button id="calc">Calculate</button>

<button id="defaultsBtn" aria-label="Default Settings"><span>⚙️</span></button>

<button id="reset">Reset</button>

    </div>
  </div>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(()=>{});
      });
    }
  </script>

<script>
  // GA-safe wrapper (works even if gtag isn't ready yet)
  function gaEvent(name, params = {}) {
    if (window.gtag) {
      window.gtag('event', name, params);
    } else {
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({ event: name, ...params });
    }
  }

  // Track PWA install (Add to Home Screen)
  window.addEventListener('appinstalled', () => {
    gaEvent('pwa_installed', { event_category: 'PWA', event_label: 'Add to Home Screen' });
  });

  // Track PWA launches when opened as an installed app
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches
                    || window.navigator.standalone === true;
  if (isStandalone) {
    gaEvent('pwa_open', { event_category: 'PWA', event_label: 'Launched in standalone' });
  }

  // Track Calculate button clicks
  document.addEventListener('DOMContentLoaded', () => {
    const calcBtn = document.getElementById('calc');
    if (!calcBtn) return;
    calcBtn.addEventListener('click', () => {
      gaEvent('calculate_tapped', { event_category: 'Interaction', event_label: 'Calculate pressed' });
    });
  });

  // If user taps the disabled Calculate, jump to the first invalid input
['pointerdown','click','touchend'].forEach(ev => {
  document.addEventListener(ev, (e) => {
    const btn = e.target && e.target.closest && e.target.closest('#calc');
    if (!btn || !btn.disabled) return;        // only handle taps on the disabled Calc
    e.preventDefault();                        // stop default "nothing happens"
    // run validation so borders update, then focus the first offender
    validateInputs();
    setTimeout(() => {
      if (!parseHM(toEl.value)) {
        toEl.focus({ preventScroll: true });
      } else if (parseDur(durEl.value) == null) {
        durEl.focus({ preventScroll: true });
      }
    }, 0);
  }, { capture: true, passive: false });
});

</script>

<!-- Defaults Modal -->
<div id="defaultsModal" style="display:none; position:fixed; inset:0; z-index:60; background:rgba(0,0,0,.6);">
  <div style="max-width:720px; margin:6vh auto; background:#0b1220; color:#e5e7eb; border:1px solid #334155; border-radius:16px; padding:18px;">
    <h2 style="font-size:20px; margin:0 0 12px;">Set Mission Profile Defaults</h2>
    <p style="margin:0 0 4px; color:#94a3b8; font-size:0.85rem;">Offsets prior to T/O</p>

    <div style="display:grid; grid-template-columns:1fr; gap:16px;">

      <!-- Single Ship -->
      <div style="border:1px solid #334155; border-radius:12px; padding:12px;">
        <h3 style="margin:0 0 8px; font-size:16px;">Single Ship</h3>
        <div class="defaults-grid">
          <label>Show</label>   <select id="d_single_show"></select>
          <label>Brief</label>  <select id="d_single_brief"></select>
          <label>Step</label>   <select id="d_single_step"></select>
          <label>Eng Start</label> <select id="d_single_eng"></select>
        </div>
      </div>

      <!-- Formation -->
      <div style="border:1px solid #334155; border-radius:12px; padding:12px;">
        <h3 style="margin:0 0 8px; font-size:16px;">Formation</h3>
        <div class="defaults-grid">
          <label>Show</label>   <select id="d_form_show"></select>
          <label>Brief</label>  <select id="d_form_brief"></select>
          <label>Step</label>   <select id="d_form_step"></select>
          <label>Eng Start</label> <select id="d_form_eng"></select>
        </div>
      </div>
    </div>

    <div style="display:flex; justify-content:flex-end; gap:8px; margin-top:16px;">
      <button id="defaultsReset" style="padding:8px 10px; border:1px solid #475569; border-radius:10px; background:#0b1220; color:#e2e8f0;">Reset</button>
      <button id="defaultsCancel" style="padding:8px 10px; border:1px solid #475569; border-radius:10px; background:#0b1220; color:#e2e8f0;">Cancel</button>
      <button id="defaultsSave" style="padding:8px 12px; border:1px solid #10b981; border-radius:10px; background:#052e2b; color:#d1fae5;">Save</button>
    </div>
  </div>
</div>

  <script src="app.js"></script>
  
</body>
</html>
